<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.atguigu.jxc.dao.PurchaseListGoodsDao">
    <delete id="delete">

        delete from
            t_purchase_list_goods
        where
            purchase_list_id = #{purchaseListId};

    </delete>
    <select id="list" resultType="com.atguigu.jxc.entity.PurchaseList">

        select
        tpl.`purchase_list_id` purchaseListId,tpl.`purchase_number` purchaseNumber,tpl.`amount_paid` amountPaid,tpl.`amount_payable` amountPayable,tpl.`purchase_date` purchaseDate,tpl.`remarks`,tpl.`state`,tpl.`supplier_id` supplierId,tpl.`user_id` userId,
            ts.supplier_name supplierName,
            tu.`true_name` trueName
        from
            t_purchase_list tpl
        left join
            t_supplier ts
        on
            tpl.`supplier_id` = ts.`supplier_id`
        left join
            t_user tu
        on
            tpl.`user_id` = tu.`user_id`
        <where>
            <if test=" purchaseNumber != null and purchaseNumber!=''">
                tpl.purchase_number like concat('%',#{purchaseNumber},'%')
            </if>
            <if test=" supplierId != null ">
                AND tpl.supplier_id = #{supplierId}
            </if>
            <if test=" state != null ">
                AND tpl.state = #{state}
            </if>
            <if test=" sTime != null and sTime!='' || eTime != null and eTime!=''">
                AND tpl.purchase_date between #{sTime} and #{eTime}
            </if>
        </where>

    </select>
    <select id="goodsList" resultType="com.atguigu.jxc.entity.PurchaseListGoods">
        select
        purchase_list_goods_id purchaseListGoodsId,
            goods_id goodsId,
            goods_code goodsCode,
            goods_name goodsName,
            goods_model goodsModel,
            goods_unit goodsUnit,
            goods_num goodsNum,
            price,
            total,
            total,
            purchase_list_id purchaseListId,
            goods_type_id goodsTypeId
        from
	    t_purchase_list_goods
        where
	    purchase_list_id = #{purchaseListId};

    </select>
</mapper>